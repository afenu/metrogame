<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Metro Master - Pro Edition</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --paris-blue: #003ca6; --success: #2ecc71; --error: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background: #f0f0f0; }
        #top-banner {
            position: fixed; top: 0; left: 0; width: 100%; height: 45px;
            z-index: 3000; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; transform: translateY(-100%); transition: 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        #top-banner.show { transform: translateY(0); }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        #ui-layer {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 90%; max-width: 500px;
        }
        .mini-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 15px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            text-align: center; border: 1px solid #ddd;
        }
        .line-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 10px 0; }
        .line-btn { border: none; padding: 8px 0; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; font-size: 0.75rem; }
        .station-target { color: var(--paris-blue); font-size: 1.3rem; margin: 10px 0; font-weight: bold; min-height: 35px; }
        .btn-play { background: var(--paris-blue); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="top-banner"></div>
<div id="map"></div>

<div id="ui-layer">
    <div id="game-ui" class="mini-card">
        <div id="selection-mode">
            <p style="margin:0 0 10px 0; font-weight: bold;">Seleziona una Linea (Rete Integrale):</p>
            <div id="line-buttons" class="line-grid"></div>
            <button class="line-btn" style="background:#333; width:100%; margin-top:5px;" onclick="selectLine('all')">SFIDA TOTALE (TUTTE LE STAZIONI)</button>
        </div>
        <div id="study-mode" class="hidden">
            <p id="study-info" style="font-size:0.8rem; margin-bottom:10px;"></p>
            <button class="btn-play" onclick="startGame()">INIZIA QUIZ</button>
        </div>
        <div id="play-mode" class="hidden">
            <div id="game-counter" style="font-size:0.75rem; font-weight:bold; color:#666;"></div>
            <div id="current-task" class="station-target">---</div>
            <button class="line-btn" style="background:#666; width:100%;" onclick="location.reload()">CAMBIA LINEA</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
   const metroData = {
    '1': { color: '#FFBE00', stations: [{n:"La DÃ©fense",lat:48.891,lng:2.238},{n:"Esplanade de la DÃ©fense",lat:48.888,lng:2.249},{n:"Pont de Neuilly",lat:48.885,lng:2.258},{n:"Les Sablons",lat:48.881,lng:2.272},{n:"Porte Maillot",lat:48.877,lng:2.282},{n:"Argentine",lat:48.875,lng:2.289},{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"George V",lat:48.872,lng:2.300},{n:"Franklin D. Roosevelt",lat:48.869,lng:2.309},{n:"Champs-Ã‰lysÃ©es-Clemenceau",lat:48.867,lng:2.313},{n:"Concorde",lat:48.865,lng:2.321},{n:"Tuileries",lat:48.864,lng:2.329},{n:"Palais Royal",lat:48.862,lng:2.336},{n:"Louvre-Rivoli",lat:48.861,lng:2.340},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"HÃ´tel de Ville",lat:48.857,lng:2.351},{n:"Saint-Paul",lat:48.855,lng:2.360},{n:"Bastille",lat:48.853,lng:2.369},{n:"Gare de Lyon",lat:48.844,lng:2.373},{n:"Reuilly-Diderot",lat:48.847,lng:2.387},{n:"Nation",lat:48.848,lng:2.395},{n:"Porte de Vincennes",lat:48.847,lng:2.406},{n:"Saint-MandÃ©",lat:48.846,lng:2.418},{n:"BÃ©rault",lat:48.845,lng:2.428},{n:"ChÃ¢teau de Vincennes",lat:48.844,lng:2.439}]},
    '2': { color: '#0055C8', stations: [{n:"Porte Dauphine",lat:48.871,lng:2.274},{n:"Victor Hugo",lat:48.869,lng:2.284},{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"Ternes",lat:48.878,lng:2.298},{n:"Courcelles",lat:48.879,lng:2.306},{n:"Monceau",lat:48.881,lng:2.314},{n:"Villiers",lat:48.881,lng:2.321},{n:"Rome",lat:48.882,lng:2.327},{n:"Place de Clichy",lat:48.883,lng:2.327},{n:"Blanche",lat:48.883,lng:2.333},{n:"Pigalle",lat:48.882,lng:2.337},{n:"Anvers",lat:48.882,lng:2.344},{n:"BarbÃ¨s-Rochechouart",lat:48.883,lng:2.350},{n:"La Chapelle",lat:48.884,lng:2.359},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Colonel Fabien",lat:48.878,lng:2.370},{n:"Belleville",lat:48.872,lng:2.377},{n:"Couronnes",lat:48.869,lng:2.380},{n:"MÃ©nilmontant",lat:48.866,lng:2.383},{n:"PÃ¨re Lachaise",lat:48.859,lng:2.396},{n:"Philippe Auguste",lat:48.856,lng:2.398},{n:"Alexandre Dumas",lat:48.853,lng:2.398},{n:"Avron",lat:48.851,lng:2.398},{n:"Nation",lat:48.848,lng:2.395}]},
    '3': { color: '#BE8043', stations: [{n:"Pont de Levallois",lat:48.897,lng:2.283},{n:"Anatole France",lat:48.892,lng:2.285},{n:"Louise Michel",lat:48.888,lng:2.287},{n:"Porte de Champerret",lat:48.885,lng:2.289},{n:"Pereire",lat:48.884,lng:2.301},{n:"Wagram",lat:48.883,lng:2.305},{n:"Malesherbes",lat:48.882,lng:2.311},{n:"Villiers",lat:48.881,lng:2.321},{n:"Europe",lat:48.879,lng:2.324},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Havre-Caumartin",lat:48.873,lng:2.328},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"Quatre-Septembre",lat:48.869,lng:2.336},{n:"Bourse",lat:48.868,lng:2.340},{n:"Sentier",lat:48.867,lng:2.346},{n:"RÃ©aumur-SÃ©bastopol",lat:48.866,lng:2.352},{n:"Arts et MÃ©tiers",lat:48.865,lng:2.356},{n:"Temple",lat:48.866,lng:2.360},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Parmentier",lat:48.865,lng:2.374},{n:"Rue Saint-Maur",lat:48.864,lng:2.379},{n:"PÃ¨re Lachaise",lat:48.859,lng:2.396},{n:"Gambetta",lat:48.864,lng:2.398},{n:"Porte de Bagnolet",lat:48.864,lng:2.409},{n:"Gallieni",lat:48.868,lng:2.416}]},
    '3b': { color: '#98D4E2', stations: [{n:"Gambetta",lat:48.864,lng:2.398},{n:"Pelleport",lat:48.868,lng:2.401},{n:"Saint-Fargeau",lat:48.871,lng:2.404},{n:"Porte des Lilas",lat:48.876,lng:2.406}]},
    '4': { color: '#B060A0', stations: [{n:"Porte de Clignancourt",lat:48.899,lng:2.344},{n:"Simplon",lat:48.894,lng:2.348},{n:"Marcadet-Poissonniers",lat:48.890,lng:2.350},{n:"ChÃ¢teau Rouge",lat:48.886,lng:2.350},{n:"BarbÃ¨s-Rochechouart",lat:48.883,lng:2.350},{n:"Gare du Nord",lat:48.880,lng:2.355},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"ChÃ¢teau d'Eau",lat:48.872,lng:2.356},{n:"Strasbourg-Saint-Denis",lat:48.869,lng:2.354},{n:"RÃ©aumur-SÃ©bastopol",lat:48.866,lng:2.352},{n:"Etienne Marcel",lat:48.863,lng:2.348},{n:"Les Halles",lat:48.862,lng:2.345},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"CitÃ©",lat:48.855,lng:2.347},{n:"Saint-Michel",lat:48.853,lng:2.344},{n:"OdÃ©on",lat:48.852,lng:2.338},{n:"Saint-Germain-des-PrÃ©s",lat:48.854,lng:2.333},{n:"Saint-Sulpice",lat:48.851,lng:2.333},{n:"Saint-Placide",lat:48.846,lng:2.327},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"Vavin",lat:48.840,lng:2.330},{n:"Raspail",lat:48.834,lng:2.330},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Mouton-Duvernet",lat:48.828,lng:2.329},{n:"AlÃ©sia",lat:48.828,lng:2.327},{n:"Porte d'OrlÃ©ans",lat:48.823,lng:2.325},{n:"Mairie de Montrouge",lat:48.812,lng:2.319},{n:"Barbara",lat:48.808,lng:2.317},{n:"Bagneux-Lucie Aubrac",lat:48.803,lng:2.316}]},
    '5': { color: '#F28E42', stations: [{n:"Bobigny-Picasso",lat:48.906,lng:2.450},{n:"Bobigny-Pantin",lat:48.897,lng:2.425},{n:"Ã‰glise de Pantin",lat:48.893,lng:2.412},{n:"Hoche",lat:48.891,lng:2.402},{n:"Porte de Pantin",lat:48.888,lng:2.392},{n:"Ourcq",lat:48.886,lng:2.381},{n:"LaumiÃ¨re",lat:48.885,lng:2.378},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"Gare du Nord",lat:48.880,lng:2.355},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"Jacques Bonsergent",lat:48.871,lng:2.360},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Oberkampf",lat:48.866,lng:2.370},{n:"Richard-Lenoir",lat:48.860,lng:2.371},{n:"BrÃ©guet-Sabin",lat:48.856,lng:2.370},{n:"Bastille",lat:48.853,lng:2.369},{n:"Quai de la RapÃ©e",lat:48.847,lng:2.368},{n:"Gare d'Austerlitz",lat:48.843,lng:2.365},{n:"Saint-Marcel",lat:48.838,lng:2.361},{n:"Campo-Formio",lat:48.835,lng:2.358},{n:"Place d'Italie",lat:48.831,lng:2.355}]},
    '6': { color: '#73CD4B', stations: [{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"KlÃ©ber",lat:48.871,lng:2.293},{n:"BoissiÃ¨re",lat:48.866,lng:2.290},{n:"TrocadÃ©ro",lat:48.862,lng:2.287},{n:"Passy",lat:48.857,lng:2.285},{n:"Bir-Hakeim",lat:48.853,lng:2.289},{n:"Dupleix",lat:48.850,lng:2.293},{n:"La Motte-Picquet",lat:48.848,lng:2.298},{n:"Cambronne",lat:48.847,lng:2.302},{n:"SÃ¨vres-Lecourbe",lat:48.845,lng:2.309},{n:"Pasteur",lat:48.842,lng:2.312},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"Edgar Quinet",lat:48.840,lng:2.324},{n:"Raspail",lat:48.834,lng:2.330},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Saint-Jacques",lat:48.833,lng:2.336},{n:"GlaciÃ¨re",lat:48.831,lng:2.343},{n:"Corvisart",lat:48.829,lng:2.350},{n:"Place d'Italie",lat:48.831,lng:2.355},{n:"Nationale",lat:48.833,lng:2.362},{n:"Chevaleret",lat:48.834,lng:2.367},{n:"Quai de la Gare",lat:48.837,lng:2.373},{n:"Bercy",lat:48.840,lng:2.379},{n:"Dugommier",lat:48.839,lng:2.389},{n:"Daumesnil",lat:48.839,lng:2.395},{n:"Bel-Air",lat:48.841,lng:2.400},{n:"Picpus",lat:48.845,lng:2.400},{n:"Nation",lat:48.848,lng:2.395}]},
    '7': { color: '#F3A4BA', stations: [{n:"La Courneuve-8 Mai 1945",lat:48.912,lng:2.410},{n:"Fort d'Aubervilliers",lat:48.908,lng:2.403},{n:"Aubervilliers-Pantin 4 Chemins",lat:48.903,lng:2.392},{n:"Porte de la Villette",lat:48.898,lng:2.388},{n:"Corentin Cariou",lat:48.894,lng:2.381},{n:"CrimÃ©e",lat:48.891,lng:2.377},{n:"Riquet",lat:48.888,lng:2.373},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"Louis Blanc",lat:48.881,lng:2.365},{n:"ChÃ¢teau-Landon",lat:48.878,lng:2.362},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"PoissonniÃ¨re",lat:48.877,lng:2.349},{n:"Cadet",lat:48.875,lng:2.343},{n:"Le Peletier",lat:48.874,lng:2.340},{n:"ChaussÃ©e d'Antin",lat:48.872,lng:2.334},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"Pyramides",lat:48.866,lng:2.335},{n:"Palais Royal",lat:48.862,lng:2.336},{n:"Pont Neuf",lat:48.858,lng:2.341},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Pont Marie",lat:48.853,lng:2.357},{n:"Sully-Morland",lat:48.851,lng:2.362},{n:"Jussieu",lat:48.845,lng:2.355},{n:"Place Monge",lat:48.843,lng:2.351},{n:"Censier-Daubenton",lat:48.840,lng:2.351},{n:"Les Gobelins",lat:48.836,lng:2.352},{n:"Place d'Italie",lat:48.831,lng:2.355},{n:"Tolbiac",lat:48.826,lng:2.357},{n:"Maison Blanche",lat:48.822,lng:2.358},{n:"Porte d'Italie",lat:48.818,lng:2.361},{n:"Porte de Choisy",lat:48.820,lng:2.364},{n:"Porte d'Ivry",lat:48.821,lng:2.371},{n:"Pierre et Marie Curie",lat:48.816,lng:2.377},{n:"Mairie d'Ivry",lat:48.811,lng:2.401},{n:"Le Kremlin-BicÃªtre",lat:48.810,lng:2.361},{n:"Villejuif-LÃ©o Lagrange",lat:48.804,lng:2.363},{n:"Villejuif-Paul Vaillant-Couturier",lat:48.796,lng:2.365},{n:"Villejuif-Louis Aragon",lat:48.783,lng:2.367}]},
    '7b': { color: '#73CD4B', stations: [{n:"Louis Blanc",lat:48.881,lng:2.365},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Bolivar",lat:48.880,lng:2.375},{n:"Buttes Chaumont",lat:48.879,lng:2.381},{n:"Botzaris",lat:48.879,lng:2.389},{n:"Danube",lat:48.881,lng:2.394},{n:"Place des FÃªtes",lat:48.877,lng:2.396},{n:"PrÃ©-Saint-Gervais",lat:48.880,lng:2.398}]},
    '8': { color: '#C5A3CA', stations: [{n:"Balard",lat:48.836,lng:2.278},{n:"Lourmel",lat:48.839,lng:2.285},{n:"Boucicaut",lat:48.841,lng:2.288},{n:"FÃ©lix Faure",lat:48.843,lng:2.292},{n:"Commerce",lat:48.845,lng:2.294},{n:"La Motte-Picquet",lat:48.848,lng:2.298},{n:"Ã‰cole Militaire",lat:48.854,lng:2.306},{n:"La Tour-Maubourg",lat:48.857,lng:2.311},{n:"Invalides",lat:48.861,lng:2.313},{n:"Concorde",lat:48.865,lng:2.321},{n:"Madeleine",lat:48.870,lng:2.324},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"Richelieu-Drouot",lat:48.872,lng:2.339},{n:"Grands Boulevards",lat:48.871,lng:2.343},{n:"Bonne Nouvelle",lat:48.870,lng:2.348},{n:"Strasbourg-Saint-Denis",lat:48.869,lng:2.354},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Filles du Calvaire",lat:48.862,lng:2.367},{n:"Saint-SÃ©bastien-Froissart",lat:48.859,lng:2.369},{n:"Chemin Vert",lat:48.855,lng:2.370},{n:"Bastille",lat:48.853,lng:2.369},{n:"Ledru-Rollin",lat:48.851,lng:2.376},{n:"Faidherbe-Chaligny",lat:48.850,lng:2.381},{n:"Reuilly-Diderot",lat:48.847,lng:2.387},{n:"Montgallet",lat:48.844,lng:2.389},{n:"Daumesnil",lat:48.839,lng:2.395},{n:"Michel Bizot",lat:48.836,lng:2.398},{n:"Porte DorÃ©e",lat:48.833,lng:2.405},{n:"Porte de Charenton",lat:48.829,lng:2.401},{n:"LibertÃ©",lat:48.825,lng:2.404},{n:"Charenton-Ã‰coles",lat:48.821,lng:2.414},{n:"Ã‰cole VÃ©tÃ©rinaire",lat:48.814,lng:2.422},{n:"Maisons-Alfort Stade",lat:48.808,lng:2.433},{n:"Maisons-Alfort Les Juilliottes",lat:48.801,lng:2.445},{n:"CrÃ©teil-L'Ã‰chat",lat:48.796,lng:2.449},{n:"CrÃ©teil-UniversitÃ©",lat:48.779,lng:2.451},{n:"CrÃ©teil-PrÃ©fecture",lat:48.771,lng:2.455},{n:"CrÃ©teil-Pointe du Lac",lat:48.768,lng:2.463}]},   
    '9': { color: '#D5C900', stations: [{n:"Pont de SÃ¨vres",lat:48.829,lng:2.230},{n:"Billancourt",lat:48.831,lng:2.238},{n:"Marcel Sembat",lat:48.833,lng:2.243},{n:"Porte de Saint-Cloud",lat:48.838,lng:2.257},{n:"Exelmans",lat:48.842,lng:2.264},{n:"Michel-Ange-Molitor",lat:48.845,lng:2.261},{n:"Michel-Ange-Auteuil",lat:48.847,lng:2.264},{n:"Jasmin",lat:48.851,lng:2.269},{n:"Ranelagh",lat:48.855,lng:2.270},{n:"La Muette",lat:48.858,lng:2.274},{n:"Rue de la Pompe",lat:48.862,lng:2.277},{n:"TrocadÃ©ro",lat:48.862,lng:2.287},{n:"IÃ©na",lat:48.865,lng:2.294},{n:"Alma-Marceau",lat:48.865,lng:2.301},{n:"Franklin D. Roosevelt",lat:48.869,lng:2.309},{n:"Saint-Philippe-du-Roule",lat:48.872,lng:2.310},{n:"Miromesnil",lat:48.873,lng:2.314},{n:"Saint-Augustin",lat:48.875,lng:2.321},{n:"Havre-Caumartin",lat:48.873,lng:2.328},{n:"ChaussÃ©e d'Antin",lat:48.872,lng:2.334},{n:"Richelieu-Drouot",lat:48.872,lng:2.339},{n:"Grands Boulevards",lat:48.871,lng:2.343},{n:"Bonne Nouvelle",lat:48.870,lng:2.348},{n:"Strasbourg-Saint-Denis",lat:48.869,lng:2.354},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Oberkampf",lat:48.866,lng:2.370},{n:"Saint-Ambroise",lat:48.861,lng:2.377},{n:"Voltaire",lat:48.858,lng:2.381},{n:"Charonne",lat:48.855,lng:2.385},{n:"Rue des Boulets",lat:48.851,lng:2.391},{n:"Nation",lat:48.848,lng:2.395},{n:"Buzenval",lat:48.852,lng:2.402},{n:"MaraÃ®chers",lat:48.853,lng:2.407},{n:"Porte de Montreuil",lat:48.854,lng:2.412},{n:"Robespierre",lat:48.856,lng:2.424},{n:"Croix de Chavaux",lat:48.858,lng:2.434},{n:"Mairie de Montreuil",lat:48.862,lng:2.441}]},
    '10': { color: '#E3B32A', stations: [{n:"Boulogne-Pont de Saint-Cloud",lat:48.841,lng:2.227},{n:"Boulogne-Jean JaurÃ¨s",lat:48.842,lng:2.240},{n:"Porte d'Auteuil",lat:48.847,lng:2.258},{n:"Michel-Ange-Auteuil",lat:48.847,lng:2.264},{n:"Michel-Ange-Molitor",lat:48.845,lng:2.261},{n:"Mirabeau",lat:48.847,lng:2.271},{n:"Javel-AndrÃ© CitroÃ«n",lat:48.846,lng:2.277},{n:"Charles Michels",lat:48.846,lng:2.285},{n:"Avenue Ã‰mile Zola",lat:48.847,lng:2.295},{n:"La Motte-Picquet",lat:48.848,lng:2.298},{n:"SÃ©gur",lat:48.847,lng:2.306},{n:"Duroc",lat:48.847,lng:2.316},{n:"Vaneau",lat:48.849,lng:2.321},{n:"SÃ¨vres-Babylone",lat:48.851,lng:2.326},{n:"Mabillon",lat:48.852,lng:2.334},{n:"OdÃ©on",lat:48.852,lng:2.338},{n:"Cluny-La Sorbonne",lat:48.851,lng:2.344},{n:"Maubert-MutualitÃ©",lat:48.850,lng:2.348},{n:"Cardinal Lemoine",lat:48.848,lng:2.352},{n:"Jussieu",lat:48.845,lng:2.355},{n:"Gare d'Austerlitz",lat:48.843,lng:2.365}]},
    '11': { color: '#8D5E2A', stations: [{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"HÃ´tel de Ville",lat:48.857,lng:2.351},{n:"Rambuteau",lat:48.862,lng:2.353},{n:"Arts et MÃ©tiers",lat:48.865,lng:2.356},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Goncourt",lat:48.870,lng:2.371},{n:"Belleville",lat:48.872,lng:2.377},{n:"PyrÃ©nÃ©es",lat:48.874,lng:2.385},{n:"Jourdain",lat:48.875,lng:2.389},{n:"Place des FÃªtes",lat:48.877,lng:2.396},{n:"TÃ©lÃ©graphe",lat:48.875,lng:2.400},{n:"Porte des Lilas",lat:48.876,lng:2.406},{n:"Mairie des Lilas",lat:48.880,lng:2.416},{n:"Serge Gainsbourg",lat:48.884,lng:2.435},{n:"Romainville-Carnot",lat:48.888,lng:2.447},{n:"Montreuil-HÃ´pital",lat:48.885,lng:2.463},{n:"Coteaux de Beauclair",lat:48.886,lng:2.469},{n:"Rosny-Bois-Perrier",lat:48.882,lng:2.482}]},
    '12': { color: '#00814F', stations: [{n:"Mairie d'Aubervilliers",lat:48.912,lng:2.379},{n:"AimÃ© CÃ©saire",lat:48.903,lng:2.371},{n:"Front Populaire",lat:48.905,lng:2.366},{n:"Porte de la Chapelle",lat:48.897,lng:2.358},{n:"Marx Dormoy",lat:48.891,lng:2.360},{n:"Marcadet-Poissonniers",lat:48.890,lng:2.350},{n:"Jules Joffrin",lat:48.892,lng:2.343},{n:"Lamarck-Caulaincourt",lat:48.889,lng:2.338},{n:"Abbesses",lat:48.884,lng:2.338},{n:"Pigalle",lat:48.882,lng:2.337},{n:"Saint-Georges",lat:48.878,lng:2.336},{n:"Notre-Dame-de-Lorette",lat:48.876,lng:2.335},{n:"TrinitÃ©-d'Estienne d'Orves",lat:48.875,lng:2.331},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Madeleine",lat:48.870,lng:2.324},{n:"Concorde",lat:48.865,lng:2.321},{n:"AssemblÃ©e Nationale",lat:48.861,lng:2.321},{n:"SolfÃ©rino",lat:48.858,lng:2.324},{n:"Rue du Bac",lat:48.855,lng:2.326},{n:"SÃ¨vres-Babylone",lat:48.851,lng:2.326},{n:"Rennes",lat:48.848,lng:2.326},{n:"Notre-Dame-des-Champs",lat:48.844,lng:2.327},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"FalguiÃ¨re",lat:48.839,lng:2.316},{n:"Pasteur",lat:48.842,lng:2.312},{n:"Volontaires",lat:48.841,lng:2.307},{n:"Vaugirard",lat:48.839,lng:2.301},{n:"Convention",lat:48.837,lng:2.296},{n:"Porte de Versailles",lat:48.832,lng:2.288},{n:"Corentin Celton",lat:48.827,lng:2.280},{n:"Mairie d'Issy",lat:48.824,lng:2.273}]},
    '13': { color: '#98D4E2', stations: [{n:"Les Courtilles",lat:48.930,lng:2.283},{n:"Les Agnettes",lat:48.924,lng:2.285},{n:"Gabriel PÃ©ri",lat:48.916,lng:2.294},{n:"Mairie de Clichy",lat:48.904,lng:2.304},{n:"Porte de Clichy",lat:48.894,lng:2.314},{n:"Brochant",lat:48.889,lng:2.319},{n:"Saint-Denis-UniversitÃ©",lat:48.945,lng:2.363},{n:"Basilique de Saint-Denis",lat:48.938,lng:2.361},{n:"Saint-Denis Porte de Paris",lat:48.930,lng:2.356},{n:"Carrefour Pleyel",lat:48.920,lng:2.345},{n:"Mairie de Saint-Ouen",lat:48.912,lng:2.334},{n:"Garibaldi",lat:48.901,lng:2.331},{n:"Porte de Saint-Ouen",lat:48.897,lng:2.329},{n:"Guy MÃ´quet",lat:48.893,lng:2.330},{n:"La Fourche",lat:48.889,lng:2.325},{n:"Place de Clichy",lat:48.883,lng:2.327},{n:"LiÃ¨ge",lat:48.879,lng:2.327},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Miromesnil",lat:48.873,lng:2.314},{n:"Champs-Ã‰lysÃ©es-Clemenceau",lat:48.867,lng:2.313},{n:"Invalides",lat:48.861,lng:2.313},{n:"Varenne",lat:48.856,lng:2.315},{n:"Saint-FranÃ§ois-Xavier",lat:48.852,lng:2.314},{n:"Duroc",lat:48.847,lng:2.316},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"GaÃ®tÃ©",lat:48.838,lng:2.322},{n:"Pernety",lat:48.834,lng:2.319},{n:"Plaisance",lat:48.831,lng:2.314},{n:"Porte de Vanves",lat:48.828,lng:2.306},{n:"Malakoff-Plateau de Vanves",lat:48.821,lng:2.296},{n:"Malakoff-Rue Etienne Dolet",lat:48.814,lng:2.300},{n:"ChÃ¢tillon-Montrouge",lat:48.809,lng:2.301}]},
    '14': { color: '#62259D', stations: [{n:"Saint-Denis Pleyel",lat:48.920,lng:2.345},{n:"Mairie de Saint-Ouen",lat:48.911,lng:2.333},{n:"Saint-Ouen",lat:48.904,lng:2.324},{n:"Porte de Clichy",lat:48.894,lng:2.314},{n:"Pont Cardinet",lat:48.888,lng:2.315},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Madeleine",lat:48.870,lng:2.324},{n:"Pyramides",lat:48.866,lng:2.335},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Gare de Lyon",lat:48.844,lng:2.373},{n:"Bercy",lat:48.840,lng:2.379},{n:"Cour Saint-Ã‰milion",lat:48.833,lng:2.388},{n:"BibliothÃ¨que FM",lat:48.829,lng:2.376},{n:"Olympiades",lat:48.822,lng:2.366},{n:"Maison Blanche",lat:48.822,lng:2.358},{n:"HÃ´pital BicÃªtre",lat:48.810,lng:2.349},{n:"Villejuif-Gustave Roussy",lat:48.792,lng:2.348},{n:"L'HaÃ¿-les-Roses",lat:48.775,lng:2.352},{n:"Chevilly-Larue",lat:48.761,lng:2.356},{n:"Thiais-Orly",lat:48.747,lng:2.361},{n:"AÃ©roport d'Orly",lat:48.726,lng:2.365}]}
};
       
    let map, targetStation, isGaming = false;
    let quizPool = [];
    let markerMap = new Map();

    map = L.map('map', { zoomControl: false }).setView([48.8566, 2.3522], 12);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const btnContainer = document.getElementById('line-buttons');
    Object.keys(metroData).sort((a,b)=>parseInt(a)-parseInt(b)).forEach(line => {
        const b = document.createElement('button');
        b.className = 'line-btn';
        b.style.backgroundColor = metroData[line].color;
        b.innerText = line;
        b.onclick = () => selectLine(line);
        btnContainer.appendChild(b);
    });

    function selectLine(lineKey) {
        markerMap.forEach(m => map.removeLayer(m));
        markerMap.clear(); quizPool = [];
        const lines = lineKey === 'all' ? Object.keys(metroData) : [lineKey];
        lines.forEach(k => {
            const line = metroData[k];
            L.polyline(line.stations.map(s=>[s.lat,s.lng]), {color:line.color, weight:4, opacity:0.5}).addTo(map);
            line.stations.forEach(s => {
                if(!markerMap.has(s.n)) {
                    quizPool.push({...s, color: line.color});
                    let m = L.circleMarker([s.lat,s.lng], {radius:7, fillColor:"white", color:"#333", weight:2, fillOpacity:1}).addTo(map);
                    m.bindTooltip(s.n);
                    m.on('click', () => {if(isGaming) verify(s.n)});
                    markerMap.set(s.n, m);
                }
            });
        });
        document.getElementById('selection-mode').classList.add('hidden');
        document.getElementById('study-mode').classList.remove('hidden');
        document.getElementById('study-info').innerText = `Caricate ${markerMap.size} stazioni. Studia la mappa!`;
        const group = new L.featureGroup(Array.from(markerMap.values()));
        map.fitBounds(group.getBounds().pad(0.2));
    }

    function startGame() {
        isGaming = true;
        document.getElementById('study-mode').classList.add('hidden');
        document.getElementById('play-mode').classList.remove('hidden');
        quizPool.sort(() => Math.random() - 0.5);
        markerMap.forEach(m => m.unbindTooltip());
        updateUI();
    }

    function updateUI() {
        if(quizPool.length === 0) {
            document.getElementById('current-task').innerText = "VITTORIA! ðŸŽ‰";
            return;
        }
        targetStation = quizPool[0];
        document.getElementById('current-task').innerText = targetStation.n;
        document.getElementById('game-counter').innerText = `RIMANENTI: ${quizPool.length}`;
    }

    function verify(n) {
        if(n === targetStation.n) {
            showBanner(`âœ… CORRETTO!`, "var(--success)");
            const m = markerMap.get(n);
            m.setStyle({fillColor: targetStation.color, color:"white", weight:1.5, radius:9});
            m.off('click'); m.bindTooltip(n);
            quizPool.shift(); updateUI();
        } else {
            showBanner(`âŒ SBAGLIATO!`, "var(--error)");
        }
    }

    function showBanner(t, c) {
        const b = document.getElementById('top-banner');
        b.innerText = t; b.style.backgroundColor = c; b.classList.add('show');
        setTimeout(()=>b.classList.remove('show'), 1200);
    }
</script>
</body>
</html>
