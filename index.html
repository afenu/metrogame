<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Metro Master - Pro Edition</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --paris-blue: #003ca6; --success: #2ecc71; --error: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background: #f0f0f0; }
        #top-banner {
            position: fixed; top: 0; left: 0; width: 100%; height: 45px;
            z-index: 3000; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; transform: translateY(-100%); transition: 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        #top-banner.show { transform: translateY(0); }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        #ui-layer {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 90%; max-width: 500px;
        }
        .mini-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 15px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            text-align: center; border: 1px solid #ddd;
        }
        .line-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 10px 0; }
        .line-btn { border: none; padding: 8px 0; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; font-size: 0.75rem; }
        .station-target { color: var(--paris-blue); font-size: 1.3rem; margin: 10px 0; font-weight: bold; min-height: 35px; }
        .btn-play { background: var(--paris-blue); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="top-banner"></div>
<div id="map"></div>

<div id="ui-layer">
    <div id="game-ui" class="mini-card">
        <div id="selection-mode">
            <p style="margin:0 0 10px 0; font-weight: bold;">Seleziona una Linea (Rete Integrale):</p>
            <div id="line-buttons" class="line-grid"></div>
            <button class="line-btn" style="background:#333; width:100%; margin-top:5px;" onclick="selectLine('all')">SFIDA TOTALE (TUTTE LE STAZIONI)</button>
        </div>
        <div id="study-mode" class="hidden">
            <p id="study-info" style="font-size:0.8rem; margin-bottom:10px;"></p>
            <button class="btn-play" onclick="startGame()">INIZIA QUIZ</button>
        </div>
        <div id="play-mode" class="hidden">
            <div id="game-counter" style="font-size:0.75rem; font-weight:bold; color:#666;"></div>
            <div id="current-task" class="station-target">---</div>
            <button class="line-btn" style="background:#666; width:100%;" onclick="location.reload()">CAMBIA LINEA</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const metroData = {
    '1': { color: '#FFBE00', stations: [{n:"La DÃ©fense",lat:48.891,lng:2.238},{n:"Pont de Neuilly",lat:48.885,lng:2.258},{n:"Porte Maillot",lat:48.877,lng:2.282},{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"Franklin D. Roosevelt",lat:48.869,lng:2.309},{n:"Concorde",lat:48.865,lng:2.321},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Bastille",lat:48.853,lng:2.369},{n:"Gare de Lyon",lat:48.844,lng:2.374},{n:"Nation",lat:48.848,lng:2.395},{n:"ChÃ¢teau de Vincennes",lat:48.844,lng:2.439}]},
    '2': { color: '#0055C8', stations: [{n:"Porte Dauphine",lat:48.871,lng:2.274},{n:"Victor Hugo",lat:48.869,lng:2.284},{n:"Villiers",lat:48.881,lng:2.321},{n:"Place de Clichy",lat:48.883,lng:2.327},{n:"Pigalle",lat:48.882,lng:2.337},{n:"Anvers",lat:48.882,lng:2.344},{n:"BarbÃ¨s-Rochechouart",lat:48.883,lng:2.350},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"PÃ¨re Lachaise",lat:48.859,lng:2.396},{n:"Nation",lat:48.848,lng:2.395}]},
    '3': { color: '#BE8043', stations: [{n:"Pont de Levallois",lat:48.897,lng:2.283},{n:"Pereire",lat:48.884,lng:2.301},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"RÃ©aumur-SÃ©bastopol",lat:48.866,lng:2.352},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"PÃ¨re Lachaise",lat:48.859,lng:2.396},{n:"Gallieni",lat:48.868,lng:2.416}]},
    '3b': { color: '#98D4E2', stations: [{n:"Gambetta",lat:48.864,lng:2.398},{n:"Porte des Lilas",lat:48.876,lng:2.406}]},
    '4': { color: '#B060A0', stations: [{n:"Porte de Clignancourt",lat:48.899,lng:2.344},{n:"Marcadet-Poissonniers",lat:48.890,lng:2.350},{n:"Gare du Nord",lat:48.880,lng:2.355},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Saint-Michel",lat:48.853,lng:2.344},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Bagneux-Lucie Aubrac",lat:48.803,lng:2.316}]},
    '5': { color: '#F28E42', stations: [{n:"Bobigny-Picasso",lat:48.906,lng:2.450},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Bastille",lat:48.853,lng:2.369},{n:"Gare d'Austerlitz",lat:48.843,lng:2.365},{n:"Place d'Italie",lat:48.831,lng:2.355}]},
    '6': { color: '#73CD4B', stations: [{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"TrocadÃ©ro",lat:48.862,lng:2.287},{n:"Bir-Hakeim",lat:48.853,lng:2.289},{n:"Montparnasse",lat:48.842,lng:2.321},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Place d'Italie",lat:48.831,lng:2.355},{n:"Bercy",lat:48.840,lng:2.379},{n:"Nation",lat:48.848,lng:2.395}]},
    '7': { color: '#F3A4BA', stations: [{n:"La Courneuve",lat:48.911,lng:2.410},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Place d'Italie",lat:48.831,lng:2.355},{n:"Villejuif-Louis Aragon",lat:48.783,lng:2.367},{n:"Mairie d'Ivry",lat:48.811,lng:2.401}]},
    '7b': { color: '#73CD4B', stations: [{n:"Louis Blanc",lat:48.881,lng:2.365},{n:"Buttes Chaumont",lat:48.879,lng:2.381},{n:"PrÃ©-Saint-Gervais",lat:48.880,lng:2.398}]},
    '8': { color: '#C5A3CA', stations: [{n:"Balard",lat:48.836,lng:2.278},{n:"Invalides",lat:48.861,lng:2.313},{n:"Concorde",lat:48.865,lng:2.321},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Bastille",lat:48.853,lng:2.369},{n:"Reuilly-Diderot",lat:48.847,lng:2.387},{n:"CrÃ©teil-Pointe du Lac",lat:48.768,lng:2.463}]},
    '9': { color: '#D5C900', stations: [{n:"Pont de SÃ¨vres",lat:48.829,lng:2.230},{n:"TrocadÃ©ro",lat:48.862,lng:2.287},{n:"Franklin D. Roosevelt",lat:48.869,lng:2.309},{n:"Havre-Caumartin",lat:48.873,lng:2.328},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Nation",lat:48.848,lng:2.395},{n:"Mairie de Montreuil",lat:48.862,lng:2.441}]},
    '10': { color: '#E3B32A', stations: [{n:"Boulogne-Pont de St-Cloud",lat:48.841,lng:2.227},{n:"La Motte-Picquet",lat:48.848,lng:2.298},{n:"SÃ¨vres-Babylone",lat:48.851,lng:2.326},{n:"OdÃ©on",lat:48.852,lng:2.338},{n:"Gare d'Austerlitz",lat:48.843,lng:2.365}]},
    '11': { color: '#8D5E2A', stations: [{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Belleville",lat:48.872,lng:2.377},{n:"Porte des Lilas",lat:48.876,lng:2.406},{n:"Rosny-Bois-Perrier",lat:48.882,lng:2.482}]},
    '12': { color: '#00814F', stations: [{n:"Mairie d'Aubervilliers",lat:48.912,lng:2.379},{n:"Pigalle",lat:48.882,lng:2.337},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Concorde",lat:48.865,lng:2.321},{n:"Montparnasse-BienvenÃ¼e",lat:48.842,lng:2.321},{n:"Mairie d'Issy",lat:48.824,lng:2.273}]},
    '13': { color: '#98D4E2', stations: [{n:"Les Courtilles",lat:48.930,lng:2.283},{n:"Saint-Denis-UniversitÃ©",lat:48.945,lng:2.363},{n:"Place de Clichy",lat:48.883,lng:2.327},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Invalides",lat:48.861,lng:2.313},{n:"Montparnasse",lat:48.842,lng:2.321},{n:"ChÃ¢tillon-Montrouge",lat:48.809,lng:2.301}]},
    '14': { color: '#62259D', stations: [{n:"Saint-Denis Pleyel",lat:48.920,lng:2.345},{n:"Saint-Ouen",lat:48.904,lng:2.324},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Gare de Lyon",lat:48.844,lng:2.373},{n:"BibliothÃ¨que FM",lat:48.829,lng:2.376},{n:"Olympiades",lat:48.822,lng:2.366},{n:"AÃ©roport d'Orly",lat:48.726,lng:2.365}]}
    };

    let map, targetStation, isGaming = false;
    let quizPool = [];
    let markerMap = new Map();

    map = L.map('map', { zoomControl: false }).setView([48.8566, 2.3522], 12);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const btnContainer = document.getElementById('line-buttons');
    Object.keys(metroData).sort((a,b)=>parseInt(a)-parseInt(b)).forEach(line => {
        const b = document.createElement('button');
        b.className = 'line-btn';
        b.style.backgroundColor = metroData[line].color;
        b.innerText = line;
        b.onclick = () => selectLine(line);
        btnContainer.appendChild(b);
    });

    function selectLine(lineKey) {
        markerMap.forEach(m => map.removeLayer(m));
        markerMap.clear(); quizPool = [];
        const lines = lineKey === 'all' ? Object.keys(metroData) : [lineKey];
        lines.forEach(k => {
            const line = metroData[k];
            L.polyline(line.stations.map(s=>[s.lat,s.lng]), {color:line.color, weight:4, opacity:0.5}).addTo(map);
            line.stations.forEach(s => {
                if(!markerMap.has(s.n)) {
                    quizPool.push({...s, color: line.color});
                    let m = L.circleMarker([s.lat,s.lng], {radius:7, fillColor:"white", color:"#333", weight:2, fillOpacity:1}).addTo(map);
                    m.bindTooltip(s.n);
                    m.on('click', () => {if(isGaming) verify(s.n)});
                    markerMap.set(s.n, m);
                }
            });
        });
        document.getElementById('selection-mode').classList.add('hidden');
        document.getElementById('study-mode').classList.remove('hidden');
        document.getElementById('study-info').innerText = `Caricate ${markerMap.size} stazioni. Studia la mappa!`;
        const group = new L.featureGroup(Array.from(markerMap.values()));
        map.fitBounds(group.getBounds().pad(0.2));
    }

    function startGame() {
        isGaming = true;
        document.getElementById('study-mode').classList.add('hidden');
        document.getElementById('play-mode').classList.remove('hidden');
        quizPool.sort(() => Math.random() - 0.5);
        markerMap.forEach(m => m.unbindTooltip());
        updateUI();
    }

    function updateUI() {
        if(quizPool.length === 0) {
            document.getElementById('current-task').innerText = "VITTORIA! ðŸŽ‰";
            return;
        }
        targetStation = quizPool[0];
        document.getElementById('current-task').innerText = targetStation.n;
        document.getElementById('game-counter').innerText = `RIMANENTI: ${quizPool.length}`;
    }

    function verify(n) {
        if(n === targetStation.n) {
            showBanner(`âœ… CORRETTO!`, "var(--success)");
            const m = markerMap.get(n);
            m.setStyle({fillColor: targetStation.color, color:"white", weight:1.5, radius:9});
            m.off('click'); m.bindTooltip(n);
            quizPool.shift(); updateUI();
        } else {
            showBanner(`âŒ SBAGLIATO!`, "var(--error)");
        }
    }

    function showBanner(t, c) {
        const b = document.getElementById('top-banner');
        b.innerText = t; b.style.backgroundColor = c; b.classList.add('show');
        setTimeout(()=>b.classList.remove('show'), 1200);
    }
</script>
</body>
</html>
