<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paris Metro Master - Pro Edition</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --paris-blue: #003ca6; --success: #2ecc71; --error: #e74c3c; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; background: #f0f0f0; }
        #top-banner {
            position: fixed; top: 0; left: 0; width: 100%; height: 45px;
            z-index: 3000; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; transform: translateY(-100%); transition: 0.3s;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        #top-banner.show { transform: translateY(0); }
        #map { height: 100vh; width: 100vw; z-index: 1; }
        #ui-layer {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 90%; max-width: 500px;
        }
        .mini-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 15px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            text-align: center; border: 1px solid #ddd;
        }
        .line-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin: 10px 0; }
        .line-btn { border: none; padding: 8px 0; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; font-size: 0.75rem; }
        .station-target { color: var(--paris-blue); font-size: 1.3rem; margin: 10px 0; font-weight: bold; min-height: 35px; }
        .btn-play { background: var(--paris-blue); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="top-banner"></div>
<div id="map"></div>

<div id="ui-layer">
    <div id="game-ui" class="mini-card">
        <div id="selection-mode">
            <p style="margin:0 0 10px 0; font-weight: bold;">Seleziona una Linea (Rete Integrale):</p>
            <div id="line-buttons" class="line-grid"></div>
            <button class="line-btn" style="background:#333; width:100%; margin-top:5px;" onclick="selectLine('all')">SFIDA TOTALE (TUTTE LE STAZIONI)</button>
        </div>
        <div id="study-mode" class="hidden">
            <p id="study-info" style="font-size:0.8rem; margin-bottom:10px;"></p>
            <button class="btn-play" onclick="startGame()">INIZIA QUIZ</button>
        </div>
        <div id="play-mode" class="hidden">
            <div id="game-counter" style="font-size:0.75rem; font-weight:bold; color:#666;"></div>
            <div id="current-task" class="station-target">---</div>
            <button class="line-btn" style="background:#666; width:100%;" onclick="location.reload()">CAMBIA LINEA</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const metroData = {
        '1': { color: '#FFBE00', stations: [{n:"La DÃ©fense",lat:48.8919,lng:2.2384},{n:"Pont de Neuilly",lat:48.885,lng:2.258},{n:"Porte Maillot",lat:48.877,lng:2.282},{n:"CdG Ã‰toile",lat:48.8738,lng:2.2950},{n:"George V",lat:48.872,lng:2.300},{n:"Franklin D. Roosevelt",lat:48.869,lng:2.309},{n:"Champs-Ã‰lysÃ©es - Clemenceau",lat:48.867,lng:2.313},{n:"Concorde",lat:48.8652,lng:2.3214},{n:"Tuileries",lat:48.864,lng:2.329},{n:"Palais Royal",lat:48.862,lng:2.336},{n:"Louvre - Rivoli",lat:48.861,lng:2.340},{n:"ChÃ¢telet",lat:48.8585,lng:2.3475},{n:"HÃ´tel de Ville",lat:48.857,lng:2.351},{n:"Saint-Paul",lat:48.855,lng:2.360},{n:"Bastille",lat:48.8531,lng:2.3691},{n:"Gare de Lyon",lat:48.844,lng:2.374},{n:"Nation",lat:48.8484,lng:2.3959},{n:"Saint-MandÃ©",lat:48.846,lng:2.418},{n:"BÃ©rault",lat:48.845,lng:2.428},{n:"ChÃ¢teau de Vincennes",lat:48.8449,lng:2.4397}]},
        '2': { color: '#0055C8', stations: [{n:"Porte Dauphine",lat:48.8712,lng:2.2745},{n:"Victor Hugo",lat:48.869,lng:2.284},{n:"Ternes",lat:48.878,lng:2.298},{n:"Courcelles",lat:48.879,lng:2.306},{n:"Monceau",lat:48.881,lng:2.314},{n:"Villiers",lat:48.881,lng:2.321},{n:"Rome",lat:48.882,lng:2.327},{n:"Place de Clichy",lat:48.883,lng:2.327},{n:"Blanche",lat:48.883,lng:2.333},{n:"Pigalle",lat:48.882,lng:2.337},{n:"Anvers",lat:48.882,lng:2.344},{n:"BarbÃ¨s - Rochechouart",lat:48.883,lng:2.350},{n:"La Chapelle",lat:48.884,lng:2.359},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Colonel Fabien",lat:48.878,lng:2.370},{n:"Belleville",lat:48.872,lng:2.377},{n:"Couronnes",lat:48.869,lng:2.380},{n:"MÃ©nilmontant",lat:48.866,lng:2.383},{n:"PÃ¨re Lachaise",lat:48.859,lng:2.396},{n:"Philippe Auguste",lat:48.856,lng:2.398},{n:"Alexandre Dumas",lat:48.853,lng:2.398},{n:"Avron",lat:48.851,lng:2.398},{n:"Nation",lat:48.848,lng:2.395}]},
        '3': { color: '#BE8043', stations: [{n:"Pont de Levallois",lat:48.897,lng:2.283},{n:"Anatole France",lat:48.892,lng:2.285},{n:"Louise Michel",lat:48.888,lng:2.287},{n:"Porte de Champerret",lat:48.885,lng:2.289},{n:"Pereire",lat:48.884,lng:2.301},{n:"Malesherbes",lat:48.882,lng:2.311},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Havre - Caumartin",lat:48.873,lng:2.328},{n:"OpÃ©ra",lat:48.871,lng:2.332},{n:"Quatre-Septembre",lat:48.869,lng:2.336},{n:"Bourse",lat:48.868,lng:2.340},{n:"Sentier",lat:48.867,lng:2.346},{n:"RÃ©aumur - SÃ©bastopol",lat:48.866,lng:2.352},{n:"Arts et MÃ©tiers",lat:48.865,lng:2.356},{n:"Temple",lat:48.866,lng:2.360},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Parmentier",lat:48.865,lng:2.374},{n:"Rue Saint-Maur",lat:48.864,lng:2.379},{n:"Gambetta",lat:48.864,lng:2.398},{n:"Porte de Bagnolet",lat:48.864,lng:2.409},{n:"Gallieni",lat:48.868,lng:2.416}]},
        '4': { color: '#B060A0', stations: [{n:"Porte de Clignancourt",lat:48.8999,lng:2.3445},{n:"Simplon",lat:48.894,lng:2.348},{n:"Marcadet - Poissonniers",lat:48.890,lng:2.350},{n:"ChÃ¢teau Rouge",lat:48.886,lng:2.350},{n:"Gare du Nord",lat:48.880,lng:2.355},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"ChÃ¢teau d'Eau",lat:48.872,lng:2.356},{n:"Strasbourg - Saint-Denis",lat:48.869,lng:2.354},{n:"Etienne Marcel",lat:48.863,lng:2.348},{n:"Les Halles",lat:48.862,lng:2.345},{n:"CitÃ©",lat:48.855,lng:2.347},{n:"Saint-Michel",lat:48.853,lng:2.344},{n:"OdÃ©on",lat:48.852,lng:2.338},{n:"Saint-Germain-des-PrÃ©s",lat:48.854,lng:2.333},{n:"Saint-Sulpice",lat:48.851,lng:2.333},{n:"Saint-Placide",lat:48.846,lng:2.327},{n:"Montparnasse-BienvenÃ¼e",lat:48.8421,lng:2.3219},{n:"Vavin",lat:48.840,lng:2.330},{n:"Raspail",lat:48.834,lng:2.330},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Mouton-Duvernet",lat:48.828,lng:2.329},{n:"AlÃ©sia",lat:48.828,lng:2.327},{n:"Porte d'OrlÃ©ans",lat:48.823,lng:2.325},{n:"Mairie de Montrouge",lat:48.812,lng:2.319},{n:"Bagneux",lat:48.803,lng:2.316}]},
        '5': { color: '#F28E42', stations: [{n:"Bobigny - Picasso",lat:48.906,lng:2.450},{n:"Bobigny - Pantin",lat:48.897,lng:2.425},{n:"Porte de Pantin",lat:48.888,lng:2.392},{n:"Ourcq",lat:48.886,lng:2.381},{n:"LaumiÃ¨re",lat:48.885,lng:2.378},{n:"JaurÃ¨s",lat:48.882,lng:2.370},{n:"Stalingrad",lat:48.884,lng:2.366},{n:"Gare du Nord",lat:48.880,lng:2.355},{n:"Gare de l'Est",lat:48.876,lng:2.358},{n:"Jacques Bonsergent",lat:48.871,lng:2.360},{n:"RÃ©publique",lat:48.867,lng:2.363},{n:"Oberkampf",lat:48.866,lng:2.370},{n:"Richard-Lenoir",lat:48.860,lng:2.371},{n:"BrÃ©guet - Sabin",lat:48.856,lng:2.370},{n:"Bastille",lat:48.853,lng:2.369},{n:"Quai de la RapÃ©e",lat:48.847,lng:2.368},{n:"Gare d'Austerlitz",lat:48.843,lng:2.365},{n:"Saint-Marcel",lat:48.838,lng:2.361},{n:"Campo-Formio",lat:48.835,lng:2.358},{n:"Place d'Italie",lat:48.831,lng:2.355}]},
        '6': { color: '#73CD4B', stations: [{n:"CdG Ã‰toile",lat:48.873,lng:2.295},{n:"KlÃ©ber",lat:48.871,lng:2.293},{n:"BoissiÃ¨re",lat:48.866,lng:2.290},{n:"TrocadÃ©ro",lat:48.862,lng:2.287},{n:"Passy",lat:48.857,lng:2.285},{n:"Bir-Hakeim",lat:48.853,lng:2.289},{n:"Dupleix",lat:48.850,lng:2.293},{n:"La Motte-Picquet",lat:48.848,lng:2.298},{n:"Cambronne",lat:48.847,lng:2.302},{n:"SÃ¨vres - Lecourbe",lat:48.845,lng:2.309},{n:"Pasteur",lat:48.842,lng:2.312},{n:"Montparnasse",lat:48.842,lng:2.321},{n:"Edgar Quinet",lat:48.840,lng:2.324},{n:"Raspail",lat:48.834,lng:2.330},{n:"Denfert-Rochereau",lat:48.833,lng:2.332},{n:"Saint-Jacques",lat:48.833,lng:2.336},{n:"GlaciÃ¨re",lat:48.831,lng:2.343},{n:"Corvisart",lat:48.829,lng:2.350},{n:"Place d'Italie",lat:48.831,lng:2.355},{n:"Nationale",lat:48.833,lng:2.362},{n:"Chevaleret",lat:48.834,lng:2.367},{n:"Quai de la Gare",lat:48.837,lng:2.373},{n:"Bercy",lat:48.840,lng:2.379},{n:"Dugommier",lat:48.839,lng:2.389},{n:"Daumesnil",lat:48.839,lng:2.395},{n:"Bel-Air",lat:48.841,lng:2.400},{n:"Picpus",lat:48.845,lng:2.400},{n:"Nation",lat:48.848,lng:2.395}]},
        '14': { color: '#62259D', stations: [{n:"Saint-Ouen",lat:48.904,lng:2.324},{n:"Porte de Clichy",lat:48.894,lng:2.314},{n:"Pont Cardinet",lat:48.888,lng:2.315},{n:"Saint-Lazare",lat:48.876,lng:2.325},{n:"Madeleine",lat:48.870,lng:2.324},{n:"Pyramides",lat:48.866,lng:2.335},{n:"ChÃ¢telet",lat:48.858,lng:2.347},{n:"Gare de Lyon",lat:48.844,lng:2.373},{n:"Bercy",lat:48.840,lng:2.379},{n:"Cour Saint-Ã‰milion",lat:48.833,lng:2.388},{n:"BibliothÃ¨que FM",lat:48.829,lng:2.376},{n:"Olympiades",lat:48.822,lng:2.366}]}
    };

    let map, targetStation, isGaming = false;
    let quizPool = [];
    let markerMap = new Map();

    map = L.map('map', { zoomControl: false }).setView([48.8566, 2.3522], 12);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    const btnContainer = document.getElementById('line-buttons');
    Object.keys(metroData).sort((a,b)=>parseInt(a)-parseInt(b)).forEach(line => {
        const b = document.createElement('button');
        b.className = 'line-btn';
        b.style.backgroundColor = metroData[line].color;
        b.innerText = line;
        b.onclick = () => selectLine(line);
        btnContainer.appendChild(b);
    });

    function selectLine(lineKey) {
        markerMap.forEach(m => map.removeLayer(m));
        markerMap.clear(); quizPool = [];
        const lines = lineKey === 'all' ? Object.keys(metroData) : [lineKey];
        lines.forEach(k => {
            const line = metroData[k];
            L.polyline(line.stations.map(s=>[s.lat,s.lng]), {color:line.color, weight:4, opacity:0.5}).addTo(map);
            line.stations.forEach(s => {
                if(!markerMap.has(s.n)) {
                    quizPool.push({...s, color: line.color});
                    let m = L.circleMarker([s.lat,s.lng], {radius:7, fillColor:"white", color:"#333", weight:2, fillOpacity:1}).addTo(map);
                    m.bindTooltip(s.n);
                    m.on('click', () => {if(isGaming) verify(s.n)});
                    markerMap.set(s.n, m);
                }
            });
        });
        document.getElementById('selection-mode').classList.add('hidden');
        document.getElementById('study-mode').classList.remove('hidden');
        document.getElementById('study-info').innerText = `Caricate ${markerMap.size} stazioni. Studia la mappa!`;
        const group = new L.featureGroup(Array.from(markerMap.values()));
        map.fitBounds(group.getBounds().pad(0.2));
    }

    function startGame() {
        isGaming = true;
        document.getElementById('study-mode').classList.add('hidden');
        document.getElementById('play-mode').classList.remove('hidden');
        quizPool.sort(() => Math.random() - 0.5);
        markerMap.forEach(m => m.unbindTooltip());
        updateUI();
    }

    function updateUI() {
        if(quizPool.length === 0) {
            document.getElementById('current-task').innerText = "VITTORIA! ðŸŽ‰";
            return;
        }
        targetStation = quizPool[0];
        document.getElementById('current-task').innerText = targetStation.n;
        document.getElementById('game-counter').innerText = `RIMANENTI: ${quizPool.length}`;
    }

    function verify(n) {
        if(n === targetStation.n) {
            showBanner(`âœ… CORRETTO!`, "var(--success)");
            const m = markerMap.get(n);
            m.setStyle({fillColor: targetStation.color, color:"white", weight:1.5, radius:9});
            m.off('click'); m.bindTooltip(n);
            quizPool.shift(); updateUI();
        } else {
            showBanner(`âŒ SBAGLIATO!`, "var(--error)");
        }
    }

    function showBanner(t, c) {
        const b = document.getElementById('top-banner');
        b.innerText = t; b.style.backgroundColor = c; b.classList.add('show');
        setTimeout(()=>b.classList.remove('show'), 1200);
    }
</script>
</body>
</html>
